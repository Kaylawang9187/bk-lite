{
  "object": "KingBase",
  "plugin": "KingBase-Exporter",
  "templates": [
    {
      "name": "数据库服务不可用",
      "alert_name": "Kingbase ${metric_instance_id} 服务宕机",
      "description": "监控数据库实例存活状态，up=0表示服务不可用，需立即检查进程或网络。",
      "metric_name": "up",
      "algorithm": "last_over_time",
      "threshold": [
        {
          "level": "critical",
          "value": 1,
          "method": "!="
        }
      ]
    },
    {
      "name": "最长事务时间超限",
      "alert_name": "Kingbase ${metric_instance_id} 存在长事务",
      "description": "检测最长事务持续时间，过长可能锁表。",
      "metric_name": "kingbase_exporter_db_max_tran_duration",
      "algorithm": "max",
      "threshold": [
        {
          "level": "critical",
          "value": 1800,
          "method": ">="
        },
        {
          "level": "error",
          "value": 600,
          "method": ">="
        },
        {
          "level": "warning",
          "value": 300,
          "method": ">="
        }
      ]
    },
    {
      "name": "缓冲区命中率过低",
      "alert_name": "Kingbase ${metric_instance_id} 缓存效率下降",
      "description": "监控缓冲区命中率，过低增加磁盘I/O压力。",
      "metric_name": "kingbase_exporter_buffers_hit_percent",
      "algorithm": "min",
      "threshold": [
        {
          "level": "critical",
          "value": 80,
          "method": "<="
        },
        {
          "level": "error",
          "value": 85,
          "method": "<="
        },
        {
          "level": "warning",
          "value": 90,
          "method": "<="
        }
      ]
    },
    {
      "name": "锁等待数过多",
      "alert_name": "Kingbase ${metric_instance_id} 锁争用严重",
      "description": "检测等待中的锁数量，过多会导致阻塞。",
      "metric_name": "kingbase_exporter_locks_waiting",
      "algorithm": "max",
      "threshold": [
        {
          "level": "critical",
          "value": 50,
          "method": ">="
        },
        {
          "level": "error",
          "value": 20,
          "method": ">="
        },
        {
          "level": "warning",
          "value": 10,
          "method": ">="
        }
      ]
    },
    {
      "name": "事务回滚率过高",
      "alert_name": "Kingbase ${metric_instance_id} 回滚率异常",
      "description": "监控事务回滚比例，过高可能表明问题。",
      "metric_name": "kingbase_exporter_rollback_percent",
      "algorithm": "max",
      "threshold": [
        {
          "level": "critical",
          "value": 20,
          "method": ">="
        },
        {
          "level": "error",
          "value": 10,
          "method": ">="
        },
        {
          "level": "warning",
          "value": 5,
          "method": ">="
        }
      ]
    },
    {
      "name": "监控采集异常",
      "alert_name": "Kingbase ${metric_instance_id} 采集失败",
      "description": "监控exporter采集状态，失败需检查。",
      "metric_name": "scrape_errors_total",
      "algorithm": "last_over_time",
      "threshold": [
        {
          "level": "critical",
          "value": 1,
          "method": ">="
        }
      ]
    },
    {
      "name": "监控采集超时",
      "alert_name": "Kingbase ${metric_instance_id} 采集超时",
      "description": "监控采集耗时，过长可能丢数据。",
      "metric_name": "scrape_duration_seconds",
      "algorithm": "max",
      "threshold": [
        {
          "level": "critical",
          "value": 30,
          "method": ">="
        },
        {
          "level": "error",
          "value": 15,
          "method": ">="
        },
        {
          "level": "warning",
          "value": 5,
          "method": ">="
        }
      ]
    }
  ]
}